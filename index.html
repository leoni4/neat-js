<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
<div id="controls">
    <button id="r-w">
        Random weight
    </button>
    <button  id="w-s">
        Weight shift
    </button>
    <button id="l-m">
        Link mutate
    </button>
    <button id="n-m">
        Node mutate
    </button>
    <button id="l-t">
        Link toggle
    </button>
    <button id="m">
        Mutate
    </button>
    <button id="toggle">
        Toggle weights
    </button>
    <br>
    <br>
    <input id="inp">
    <button id="c">
        Calculate
    </button>
    <br>
    <br>
</div>
<div id="container"></div>
<script src="./dist/main.js"></script>
<script>
    function main() {
        const neat = new NeatJS.Neat(2, 1, 100);

        const test = {
            input: [
                [0, 0],
                [1, 1],
                [1, 0],
                [0, 1],
            ],
            output: [0, 0, 1, 1],
        };

        neat.evolve();
        let k = 0;
        let error = 1;
        const epochs = 1000;
        setTimeout(function run() {
            //  console.time('run()');
            let topScore = 0;
            let topClient = neat.clients[0];
            let localError = 0;
            for (let i = 0; i < neat.clients.length; i += 1) {
                const c = neat.clients[i];
                localError = 0;
                test.input.forEach((inp, i) => {
                    const out = c.calculate(inp)[0];
                    localError += Math.abs(out - test.output[i]);
                });
                c.score = 1 - localError / 4;
                if (c.score > topScore) {
                    topScore = c.score;
                    topClient = c;
                }
            }
            error = 1 - topScore;
            console.log('###################');
            neat.printSpecies();
            console.log('-------');
            console.log('EPOCH:', k, '| error:', error);
            if (k > epochs || error < 0) {
                //   console.timeEnd('run()');
                console.log('Finished');
                return;
            }
            k++;
            neat.evolve();
            // console.timeEnd('run()');
            setTimeout(run, 100);
        }, 1);
    }
    main()
</script>
</body>
</html>
